<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.21/vue.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/1.2.0/superagent.js" charset="utf-8"></script>
    <style media="screen">
      li.status-0 {
        background-color: #3CA39C;
      }
      li.status-1 {
        background-color: #FF827D;
      }
      li.status-2 {
        background-color: #E0DCBB;
      }
      .staggered-transition {
        transition: all 0.5s ease;
        margin: 0;
        height: 20px;
      }
      .staggered-enter,
      .staggered-leave {
        opacity: 0;
        height: 0;
      }

    </style>
    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', init);
      function init() {
        var TaskList = Vue.extend({
          props: ["project"],
          template: `
            <div v-if="project">
              <h1>{{project.name}}のタスク一覧</h1>
              <ul class="task-list">
                <li class="status-{{item.status}}" v-for="item in tasks| limitBy 5" transition="staggered" stagger="20">
                  {{ item.description }}
                </li>
              </ul>
            </div>
          `,
          data: function () {
            return {tasks: []};
          },
          init: function () {},
          ready: function () {
            if (this.project != null) 
              this.call()
            this.$watch("project", this.call);
          },
          methods: {
            call: function () {
              superagent.get("/task/" + this.project.id).set('Accept', 'application/json').end((err, res) => this.tasks = JSON.parse(res.text))
            }
          }
        })
        Vue.component('task-list', TaskList);
        var ProjectList = Vue.extend({
          template: `
              <ul class="project-list">
                <li class="" v-for="project in projects"  v-on:click="select(project)">
                  {{ project.name }}
                </li>
              </ul>
              <task-list :project="selectedProject"></task-list>
            `,
          data: function () {
            return {selectedProject: null, projects: []};
          },
          init: function () {
            superagent.get("/project").set('Accept', 'application/json').end((err, res) => {
              this.projects = JSON.parse(res.text);
              this.selectedProject = this.projects[0]
            });
          },
          methods: {
            select: function (project) {
              this.selectedProject = project
            }
          }
        })
        Vue.component('project-list', ProjectList);
        var App = new Vue({el: "#app"});
        console.log("test");
      }
    </script>
  </head>
  <body id="app">
    <h1>プロジェクト一覧</h1>
    <project-list></project-list>
  </body>
</html>